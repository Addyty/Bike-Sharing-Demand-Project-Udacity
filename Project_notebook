{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "18ea4cb3-7627-4029-8113-fdc178aef4de",
   "metadata": {},
   "source": [
    "# Report: \n",
    "## Predict Bike Sharing Demand with AutoGluon Solution"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "37c4ee2f-c4a6-4f70-aa6b-18ac37997208",
   "metadata": {},
   "source": [
    "#### Aaditya Tyagi"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "75ce6935-c649-4ec7-94a8-7c2d9d96f6a7",
   "metadata": {},
   "source": [
    "## Initial Training"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6cd3726e-e19b-484c-8a7a-68acb9050558",
   "metadata": {},
   "source": [
    "### What did you realize when you tried to submit your predictions? What changes were needed to the output of the predictor to submit your results?"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "db95d46d-babf-4a9f-ad6b-ef9bf2d3cc4d",
   "metadata": {},
   "source": [
    "During my initial presentation of predicted results on Kaggle, a lot of changes needed to be made before the presentation. But as usual this was my first test in which the model was trained with default parameters as the baseline model to get only one score so I can use it to compare with the predicted score after doing feature engineering and hyperparameter tuning I can use Initially I only parse the datetime column of the dataset, which is not enough for better performance of the model. Here are some of the parameters and data columns I used in my initial prediction:\n",
    "\n",
    "* Since 'count' is the target column I'm trying to estimate, this is the label I set.\n",
    "* I ignore the 'random' and 'registered' columns as they are not present in the test dataset.\n",
    "* I choose `root_mean_squared_error` as the metric to be used for evaluation.\n",
    "* I have set a time limit of 10 minutes (600 seconds).\n",
    "* And the preset I use to focus on building the best model is `best_quality`.\n",
    "\n",
    "Since I used the data directly without doing feature engineering, the predictive score of the model was not that good and the score on Kaggle was also not that good."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dbec63f1-c65f-4319-9ef6-d8a815165e99",
   "metadata": {},
   "source": [
    "### What was the top ranked model that performed?"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1c7bbf51-3a68-4fba-aea9-8db0bfbe2ec8",
   "metadata": {},
   "source": [
    "The top ranked model in the initial training is **WeightedEnsemble_L3.** The following are the various results of this model:\n",
    "\n",
    "* Model: The model is a weighted combination model, which combines the predictions of several individual models to produce the final prediction.\n",
    "\n",
    "* score_value: The validation score for this model is **-50.739530**.\n",
    "\n",
    "* pred_time_val: The prediction time for the validation set is **5.291339 seconds.** It indicates the time taken by the model to make predictions on the validation data.\n",
    "\n",
    "* fit_time: The fit time represents the total time taken by the model to train, including all individual models and ensemble builds. In this case, the fit time is **421.446217 seconds.**\n",
    "\n",
    "* can_infer: A value of **True** indicates that the model is capable of making predictions."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8d8e105e-c052-4052-a87b-09dae251573f",
   "metadata": {},
   "source": [
    "## Exploratory data analysis and feature creation"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fe24331b-9d29-46e9-b9c5-651ae1876754",
   "metadata": {},
   "source": [
    "### What did the exploratory analysis find and how did you add additional features?"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c262a3f4-83ef-42c8-ac6a-89900ceb75f3",
   "metadata": {},
   "source": [
    "Exploratory analysis is the preliminary examination of data to discover patterns, relationships, and insights. It is often used to understand the structure of a dataset and identify possible relationships between variables.\n",
    "\n",
    "* The data for `year`, `month`, `day`, `day of the week` and `hour` were extracted as independent features separate from the `datetime` feature using data feature extraction. After feature extraction, the `datetime` feature was removed.\n",
    "\n",
    "* Feature `datetime` was parsed as a datetime feature to retrieve the hour information from the timestamp\n",
    "\n",
    "* The independent attributes `season` and `weather` were initially read as `integer`. Since these are categorical variables, they were converted to the `category` data type.\n",
    "\n",
    "* The `casual` and `registered` features are only present in the train dataset and absent in the test data, therefore, these features were ignored during model training  and after removing there, it was observed that the RMSE scores improved significantly and these independent features were highly correlated with the target variable."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8fc3187f-a48e-4977-962c-a480faedf919",
   "metadata": {},
   "source": [
    "### How much better did your model preform after adding additional features and why do you think that is?"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "deb4c370-ff48-4fab-865f-9910a6c14d0c",
   "metadata": {},
   "source": [
    "Analyzing the best model scores of the `initial prediction` and the `second prediction (after EDA)`, it is observed that there is an improvement of `74%`.\n",
    "\n",
    "According to me this is possible because of the following changes made to the data.\n",
    "\n",
    "* I have extracted the `year`, `month`, `day`, `day of week` and `hour` elements of the datetime feature as individual attributes. which leads to a significant improvement in the predicted values.\n",
    "\n",
    "* Also the `Data Type` of the attributes `Season` and `Weather` are changed to categorical variables. Which also contributes to this improvement.\n",
    "\n",
    "* And last thing I am not considering features like `casual` and `registered` in `training set` because they are not present in `test data set`."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2a92638c-3ba9-42d5-97ad-3ca19dfa7418",
   "metadata": {},
   "source": [
    "## Hyper parameter tuning"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "18395f57-6712-4f6e-90f4-fb517717929c",
   "metadata": {},
   "source": [
    "### How much better did your model preform after trying different hyper parameters?"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e2082d7a-e5a6-41e7-aabe-454893050274",
   "metadata": {},
   "source": [
    "Analyzing the best model scores of the `initial prediction` and the `third prediction`, it is observed that there is an improvement of `75%`."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "33bfe963-4568-4b63-9444-e25ff37ed34f",
   "metadata": {},
   "source": [
    "### If you were given more time with this dataset, where do you think you would spend more time?"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "054f89fd-2e08-4cc0-9fb4-eb45f17b1609",
   "metadata": {},
   "source": [
    "In fact I already spend more time in forecasting with hyperparameter and I have seen a little more improvement compared to the second forecast. Therefore, I would prefer to spend more time in the third prediction (with hyperparameters)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ec8679c0-ec92-4ec5-81bc-519eda128972",
   "metadata": {},
   "source": [
    "### Create a table with the models you ran, the hyperparameters modified, and the kaggle score."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "243e86e8-c651-44be-bdca-43eb7c264730",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>model</th>\n",
       "      <th>hpo1</th>\n",
       "      <th>hpo2</th>\n",
       "      <th>hpo3</th>\n",
       "      <th>score</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>initial</td>\n",
       "      <td>eval_matrix: 'root mean squared error'</td>\n",
       "      <td>eval_matrix: 'root mean squared error'</td>\n",
       "      <td>auto_stack=True</td>\n",
       "      <td>1.79990</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>add_features</td>\n",
       "      <td>perset: best quality</td>\n",
       "      <td>perset: best quality</td>\n",
       "      <td>refit_full=True</td>\n",
       "      <td>0.45138</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>hpo</td>\n",
       "      <td>Time Limit: 600</td>\n",
       "      <td>Time Limit: 600</td>\n",
       "      <td>Time Limit: 1200</td>\n",
       "      <td>0.44362</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          model                                    hpo1  \\\n",
       "0       initial  eval_matrix: 'root mean squared error'   \n",
       "1  add_features                    perset: best quality   \n",
       "2           hpo                         Time Limit: 600   \n",
       "\n",
       "                                     hpo2              hpo3    score  \n",
       "0  eval_matrix: 'root mean squared error'   auto_stack=True  1.79990  \n",
       "1                    perset: best quality   refit_full=True  0.45138  \n",
       "2                         Time Limit: 600  Time Limit: 1200  0.44362  "
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "pd.DataFrame({\n",
    "    \"model\": [\"initial\", \"add_features\", \"hpo\"],\n",
    "    \"hpo1\": [\"eval_matrix: 'root mean squared error'\", \"perset: best quality\", \"Time Limit: 600\"],\n",
    "    \"hpo2\": [\"eval_matrix: 'root mean squared error'\", \"perset: best quality\", \"Time Limit: 600\"],\n",
    "    \"hpo3\": [\"auto_stack=True\", \"refit_full=True\", \"Time Limit: 1200\"],\n",
    "    \"score\": [1.7999, 0.45138, 0.44362]\n",
    "})"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "40c8fb62-52e2-4c72-9831-d475d886dcd4",
   "metadata": {},
   "source": [
    "### Create a line plot showing the top model score for the three (or more) training runs during the project."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bff840e2-7c21-4265-9b33-9cc12c298143",
   "metadata": {},
   "source": [
    "![model_train_score.png](img/model_test_score.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3391f0cd-401b-42ca-b97f-4726ce3fe194",
   "metadata": {},
   "source": [
    "### Create a line plot showing the top kaggle score for the three (or more) prediction submissions during the project."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f1130cbb-e436-40c2-9396-469f72f205d5",
   "metadata": {},
   "source": [
    "![model_test_score.png](img/model_test_score.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b58383af-b4aa-4cc3-a051-c719d3d16f5a",
   "metadata": {},
   "source": [
    "## Summary"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fba3ed9b-7ba6-4e2d-894d-b4ac0302db39",
   "metadata": {},
   "source": [
    "Automated Stack Ensemble and Regression Models: AutoGluon was used to create both automated stack ensembles and individual regression models for tabular data. This approach allowed for quick prototyping of baseline models, saving significant time and effort in the initial stages of the project.\n",
    "\n",
    "**Improved Results with EDA and Feature Engineering:** The top-ranked AutoGluon-based model demonstrated significant improvement by leveraging data obtained after extensive exploratory data analysis (EDA) and feature engineering. This highlights the importance of data preprocessing and understanding the data's underlying patterns.\n",
    "\n",
    "**Automatic Hyperparameter Tuning and Model Selection:** AutoGluon's capabilities in automatic hyperparameter tuning, model selection, and ensembling proved to be beneficial. It allowed the framework to explore and exploit the best possible combinations of hyperparameters and models, leading to enhanced performance without manual intervention.\n",
    "\n",
    "**Improved Performance through Hyperparameter Tuning:** Utilizing AutoGluon's hyperparameter tuning resulted in improved performance compared to the initial raw submission. This indicates that fine-tuning model hyperparameters can have a significant impact on predictive accuracy.\n",
    "\n",
    "**Cumbersome Process and Time Limit Dependency:** One observation was that hyperparameter tuning using AutoGluon could be a cumbersome process. The success of hyperparameter tuning was found to be highly dependent on factors like time limits, prescribed presets, the family of models used, and the range of hyperparameters to be tuned. This suggests that finding the optimal hyperparameters can be a challenging task and may require experimentation.\n",
    "\n",
    "Overall, it's evident that AutoGluon's capabilities in automating various aspects of the machine learning pipeline, such as hyperparameter tuning and model selection, greatly contributed to the success of the bike sharing demand prediction project. However, it's important to acknowledge that hyperparameter tuning can be a complex and time-consuming process, and finding the right balance between exploration and exploitation can be crucial for achieving the best possible results.\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
